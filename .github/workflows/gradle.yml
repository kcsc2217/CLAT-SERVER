name: Java CI with Gradle

on:
  push:
    branches: [ "develop" ]  # develop 브랜치에 푸시될 때 배포
  pull_request:
    branches: [ "develop" ]  # develop 브랜치에 대한 PR에 대해서도 실행

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: read

    steps:
    - uses: actions/checkout@v4
      with:
        submodules: true  # 서브모듈 초기화는 이곳에 위치해야 합니다.
        token: ${{ secrets.GIT_TOKEN }}

    - name: Set up JDK 17
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'
        
    - name: Setup Gradle
      uses: gradle/actions/setup-gradle@af1da67850ed9a4cedd57bfd976089dd991e2582  # v4.0.0

    - name: Build with Gradle Wrapper
      run: ./gradlew build

  # deploy:
  #   if: github.ref == 'refs/heads/develop'  # develop 브랜치에 푸시될 때 배포
  #   runs-on: ubuntu-latest
  #   needs: build
  #   steps:
  #     - uses: actions/checkout@v4
  #       with:
  #         submodules: true  # 서브모듈 초기화는 이곳에 위치해야 합니다.
  #         token: ${{ secrets.GIT_TOKEN }}
  
  #     - name: Set up JDK 17
  #       uses: actions/setup-java@v4
  #       with:
  #         java-version: '17'
  #         distribution: 'temurin'
  
  #     - name: Deploy to EC2 using SSH
  #       uses: appleboy/ssh-action@master
  #       with:
  #         host: ${{ secrets.EC2_HOST }}
  #         username: ubuntu
  #         key: ${{ secrets.EC2_SSH_KEY }}  # SSH 키
  #         port: 22  # 기본 포트는 22입니다. EC2 인스턴스의 포트가 다르면 변경하세요.
  #         script: |
  #           # 프로젝트 디렉토리로 이동
  #           cd /home/ubuntu/CLAT-SERVER
            
  #           # 최신 코드로 업데이트
  #           git pull origin develop
      
  #           # Gradle 빌드
  #           ./gradlew build
      
  #           # 빌드된 JAR 파일 위치로 이동
  #           cd build/libs
      
  #           # 기존 프로세스 종료 (이미 실행 중이라면)
  #           pkill -f 'java -jar clat-0.0.1-SNAPSHOT.jar' || true
      
  #           # 애플리케이션 실행 (백그라운드에서)
  #           nohup java -jar clat-0.0.1-SNAPSHOT.jar > /home/ubuntu/clat.log 2>&1 &
            
  #           # 프로세스 상태 확인 (선택 사항)
  #           ps aux | grep 'java -jar clat-0.0.1-SNAPSHOT.jar'










  
